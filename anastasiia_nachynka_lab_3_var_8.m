% Лабораторна робота з проектування цифрових фільтрів в Filter Design and Analysis Tool
% Варіант 8
% Задані параметри:

% ФНЧ (Фільтр низьких частот):
fp_LPF = 120;   % Частота пропускання, Гц
fs_LPF = 220;   % Частота загородження, Гц
Rp = 3;         % Пульсації в смузі пропускання, дБ
Rs = 20;        % Загасання в смузі загородження, дБ
Fs = 1000;      % Частота дискретизації, Гц

% ФВЧ (Фільтр високих частот):
fp_HPF = 220;   % Частота пропускання, Гц
fs_HPF = 120;   % Частота загородження, Гц
% Rp та Rs ті ж самі
% Fs та ж сама

% -----------------------------------------
% 1. Розрахунок мінімального порядку фільтрів та частот зрізу

% 1.1 ФНЧ (Фільтр низьких частот)

% Нормалізація частот
Wp_LPF = fp_LPF / (Fs/2);  % Нормалізована частота пропускання
Ws_LPF = fs_LPF / (Fs/2);  % Нормалізована частота загородження

% Перетворення частот в аналогові (перед дискретизацією)
omega_p_LPF = 2 * Fs * tan(pi * Wp_LPF / 2);
omega_s_LPF = 2 * Fs * tan(pi * Ws_LPF / 2);

% Розрахунок порядку фільтра
n_LPF = ceil(log10((10^(Rs/10)-1)/(10^(Rp/10)-1)) / (2 * log10(omega_s_LPF / omega_p_LPF)));

% Розрахунок частоти зрізу
omega_c_LPF = omega_p_LPF / ((10^(Rp/10)-1)^(1/(2*n_LPF)));

% Перетворення назад в цифрову частоту
Wn_LPF = (2 / pi) * atan(omega_c_LPF / (2 * Fs));

% Проектування фільтру Баттерворта
[b_LPF, a_LPF] = butter(n_LPF, Wn_LPF, 'low');

% 1.2 ФВЧ (Фільтр високих частот)

% Нормалізація частот
Wp_HPF = fp_HPF / (Fs/2);  % Нормалізована частота пропускання
Ws_HPF = fs_HPF / (Fs/2);  % Нормалізована частота загородження

% Перетворення частот в аналогові
omega_p_HPF = 2 * Fs * tan(pi * Wp_HPF / 2);
omega_s_HPF = 2 * Fs * tan(pi * Ws_HPF / 2);

% Розрахунок порядку фільтра
n_HPF = ceil(log10((10^(Rs/10)-1)/(10^(Rp/10)-1)) / (2 * log10(omega_p_HPF / omega_s_HPF)));

% Розрахунок частоти зрізу
omega_c_HPF = omega_p_HPF * ((10^(Rp/10)-1)^(1/(2*n_HPF)));

% Перетворення назад в цифрову частоту
Wn_HPF = (2 / pi) * atan(omega_c_HPF / (2 * Fs));

% Проектування фільтру Баттерворта
[b_HPF, a_HPF] = butter(n_HPF, Wn_HPF, 'high');

% -----------------------------------------
% 2. Побудова АЧХ та ФЧХ фільтрів

% 2.1 ФНЧ
figure;
freqz(b_LPF, a_LPF, 1024, Fs);
title('АЧХ та ФЧХ ФНЧ Баттерворта');

% 2.2 ФВЧ
figure;
freqz(b_HPF, a_HPF, 1024, Fs);
title('АЧХ та ФЧХ ФВЧ Баттерворта');

% -----------------------------------------
% 3. Побудова карти нулів та полюсів

% 3.1 ФНЧ
figure;
zplane(b_LPF, a_LPF);
title('Нулі та полюси ФНЧ Баттерворта');

% 3.2 ФВЧ
figure;
zplane(b_HPF, a_HPF);
title('Нулі та полюси ФВЧ Баттерворта');

% -----------------------------------------
% 4. Побудова імпульсної характеристики та перевірка стійкості

% 4.1 ФНЧ
figure;
impz(b_LPF, a_LPF);
title('Імпульсна характеристика ФНЧ Баттерворта');

% 4.2 ФВЧ
figure;
impz(b_HPF, a_HPF);
title('Імпульсна характеристика ФВЧ Баттерворта');

% -----------------------------------------
% 5. Побудова структури фільтру та визначення коефіцієнтів каскадної структури

% 5.1 ФНЧ
[sos_LPF, g_LPF] = tf2sos(b_LPF, a_LPF);
% Виведення коефіцієнтів каскадної структури
disp('Коефіцієнти каскадної структури для ФНЧ:');
disp(sos_LPF);

% 5.2 ФВЧ
[sos_HPF, g_HPF] = tf2sos(b_HPF, a_HPF);
% Виведення коефіцієнтів каскадної структури
disp('Коефіцієнти каскадної структури для ФВЧ:');
disp(sos_HPF);

% -----------------------------------------
% 6. Проектування фільтрів зі скінченною імпульсною характеристикою (FIR)

% 6.1 ФНЧ

% Визначаємо порядок фільтру
% Для FIR фільтрів порядок зазвичай вищий, ніж для IIR
delta_f_LPF = fs_LPF - fp_LPF;
n_FIR_LPF = ceil((Fs / delta_f_LPF) * 4);  % Формула для оцінки порядку

% Забезпечуємо, щоб порядок був парним
if mod(n_FIR_LPF,2) ~= 0
    n_FIR_LPF = n_FIR_LPF + 1;
end

% Проектуємо фільтр за допомогою віконної функції
b_FIR_LPF = fir1(n_FIR_LPF, Wp_LPF, 'low', hamming(n_FIR_LPF+1));
a_FIR_LPF = 1;

% 6.2 ФВЧ

delta_f_HPF = fp_HPF - fs_HPF;
n_FIR_HPF = ceil((Fs / delta_f_HPF) * 4);  % Формула для оцінки порядку

% Забезпечуємо, щоб порядок був парним
if mod(n_FIR_HPF,2) ~= 0
    n_FIR_HPF = n_FIR_HPF + 1;
end

% Проектуємо фільтр за допомогою віконної функції
b_FIR_HPF = fir1(n_FIR_HPF, Wp_HPF, 'high', hamming(n_FIR_HPF+1));
a_FIR_HPF = 1;

% -----------------------------------------
% 7. Побудова АЧХ та ФЧХ FIR фільтрів

% 7.1 ФНЧ FIR
figure;
freqz(b_FIR_LPF, a_FIR_LPF, 1024, Fs);
title('АЧХ та ФЧХ ФНЧ FIR фільтру');

% 7.2 ФВЧ FIR
figure;
freqz(b_FIR_HPF, a_FIR_HPF, 1024, Fs);
title('АЧХ та ФЧХ ФВЧ FIR фільтру');

% -----------------------------------------
% 8. Побудова імпульсних характеристик FIR фільтрів

% 8.1 ФНЧ FIR
figure;
impz(b_FIR_LPF, a_FIR_LPF);
title('Імпульсна характеристика ФНЧ FIR фільтру');

% 8.2 ФВЧ FIR
figure;
impz(b_FIR_HPF, a_FIR_HPF);
title('Імпульсна характеристика ФВЧ FIR фільтру');

% -----------------------------------------
% 9. Побудова карти нулів та полюсів FIR фільтрів

% 9.1 ФНЧ FIR
figure;
zplane(b_FIR_LPF, a_FIR_LPF);
title('Нулі та полюси ФНЧ FIR фільтру');

% 9.2 ФВЧ FIR
figure;
zplane(b_FIR_HPF, a_FIR_HPF);
title('Нулі та полюси ФВЧ FIR фільтру');

% -----------------------------------------
% 10. Виведення коефіцієнтів фільтрів

% 10.1 Коефіцієнти ФНЧ IIR
disp('Коефіцієнти чисельника (b) для ФНЧ IIR:');
disp(b_LPF);
disp('Коефіцієнти знаменника (a) для ФНЧ IIR:');
disp(a_LPF);

% 10.2 Коефіцієнти ФВЧ IIR
disp('Коефіцієнти чисельника (b) для ФВЧ IIR:');
disp(b_HPF);
disp('Коефіцієнти знаменника (a) для ФВЧ IIR:');
disp(a_HPF);

% 10.3 Коефіцієнти ФНЧ FIR
disp('Коефіцієнти чисельника (b) для ФНЧ FIR:');
disp(b_FIR_LPF);

% 10.4 Коефіцієнти ФВЧ FIR
disp('Коефіцієнти чисельника (b) для ФВЧ FIR:');
disp(b_FIR_HPF);

% ------------------- Висновки -------------------

% У даній лабораторній роботі були спроектовані цифрові фільтри з нескінченною
% та скінченною імпульсною характеристикою для заданих параметрів.
% Порівняння характеристик IIR та FIR фільтрів показує, що FIR фільтри мають
% вищий порядок, але забезпечують лінійну фазу та є завжди стійкими.
% IIR фільтри мають нижчий порядок, але можуть бути нестійкими та мають
% нелінійну фазову характеристику.

% Під час проектування були побудовані амплітудно-частотні та
% фазочастотні характеристики, імпульсні характеристики, карти нулів та полюсів,
% а також визначені коефіцієнти фільтрів та їх каскадних структур.

% -----------------------------------------
